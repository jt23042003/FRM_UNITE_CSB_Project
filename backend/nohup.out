INFO:     Will watch for changes in these directories: ['/home/ubuntu/FRD_Project']
INFO:     Uvicorn running on http://0.0.0.0:9000 (Press CTRL+C to quit)
INFO:     Started reloader process [3272084] using StatReload
INFO:     Started server process [3272086]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
ThreadPoolExecutor initialized.
✅ AnomalyDetector initialized. (Placeholder for model loading).
✅ AnomalyDetector initialized. (Placeholder for model loading).
FastAPI application startup complete.
INFO:     121.242.232.133:53111 - "OPTIONS /api/login HTTP/1.1" 200 OK
INFO:     121.242.232.133:53111 - "POST /api/login HTTP/1.1" 200 OK
INFO:     121.242.232.133:53111 - "OPTIONS /api/case-list HTTP/1.1" 200 OK
DEBUG: Fetching user_type for user: 'jalaj'
DEBUG: User 'jalaj' has user_type: 'risk_officer'
DEBUG: Dashboard: current_logged_in_username: 'jalaj'
DEBUG: Dashboard: user_type_from_db for 'jalaj': 'risk_officer'
DEBUG: Final Dashboard SQL: 
                        SELECT
                            ack_no,
                            complaint_type,
                            source,
                            complaint_type AS match_type,
                            location,
                            COALESCE(transaction_amount, 0) AS transaction_amount,
                            status,
                            assigned_to
                        FROM case_master
                     WHERE assigned_to = %s
DEBUG: Final Dashboard Params: ['jalaj']
DEBUG: Fetched 1 rows for dashboard.
INFO:     121.242.232.133:34076 - "GET /api/case-list HTTP/1.1" 200 OK
INFO:     121.242.232.133:34076 - "OPTIONS /api/case/ACKNEW202506/customer-details HTTP/1.1" 200 OK
INFO:     121.242.232.133:53111 - "OPTIONS /api/case/ACKNEW202506/documents HTTP/1.1" 200 OK
INFO:     121.242.232.133:4344 - "OPTIONS /api/case/ACKNEW202506/decision HTTP/1.1" 200 OK
INFO:     121.242.232.133:34076 - "GET /api/case/ACKNEW202506/customer-details HTTP/1.1" 200 OK
Fetched 0 documents from DB for ACK ACKNEW202506.
INFO:     121.242.232.133:53111 - "GET /api/case/ACKNEW202506/documents HTTP/1.1" 200 OK
INFO:     121.242.232.133:34314 - "GET /api/case/ACKNEW202506/decision HTTP/1.1" 200 OK
INFO:     121.242.232.133:53111 - "OPTIONS /api/case/ACKNEW202506/risk-profile HTTP/1.1" 200 OK
INFO:     121.242.232.133:34314 - "GET /api/case/ACKNEW202506/risk-profile HTTP/1.1" 200 OK
INFO:     121.242.232.133:52717 - "POST /api/login HTTP/1.1" 200 OK
DEBUG: Fetching user_type for user: 'shiva'
DEBUG: User 'shiva' has user_type: 'CRO'
DEBUG: Dashboard: current_logged_in_username: 'shiva'
DEBUG: Dashboard: user_type_from_db for 'shiva': 'CRO'
DEBUG: Final Dashboard SQL: 
                        SELECT
                            ack_no,
                            complaint_type,
                            source,
                            complaint_type AS match_type,
                            location,
                            COALESCE(transaction_amount, 0) AS transaction_amount,
                            status,
                            assigned_to
                        FROM case_master
                    
DEBUG: Final Dashboard Params: []
DEBUG: Fetched 12 rows for dashboard.
INFO:     121.242.232.133:52717 - "GET /api/case-list HTTP/1.1" 200 OK
INFO:     121.242.232.133:34055 - "OPTIONS /api/case/ACKNEW202518/documents HTTP/1.1" 200 OK
INFO:     121.242.232.133:38091 - "OPTIONS /api/case/ACKNEW202518/customer-details HTTP/1.1" 200 OK
INFO:     121.242.232.133:39056 - "OPTIONS /api/case/ACKNEW202518/decision HTTP/1.1" 200 OK
INFO:     121.242.232.133:34357 - "GET /api/case/ACKNEW202518/customer-details HTTP/1.1" 200 OK
Fetched 2 documents from DB for ACK ACKNEW202518.
INFO:     121.242.232.133:38091 - "GET /api/case/ACKNEW202518/documents HTTP/1.1" 200 OK
INFO:     121.242.232.133:34055 - "GET /api/case/ACKNEW202518/decision HTTP/1.1" 200 OK
INFO:     121.242.232.133:34357 - "OPTIONS /api/case/ACKNEW202518/risk-profile HTTP/1.1" 200 OK
INFO:     121.242.232.133:34055 - "GET /api/case/ACKNEW202518/risk-profile HTTP/1.1" 200 OK
INFO:     121.242.232.133:33873 - "POST /api/login HTTP/1.1" 200 OK
DEBUG: Fetching user_type for user: 'shiva'
DEBUG: User 'shiva' has user_type: 'CRO'
DEBUG: Dashboard: current_logged_in_username: 'shiva'
DEBUG: Dashboard: user_type_from_db for 'shiva': 'CRO'
DEBUG: Final Dashboard SQL: 
                        SELECT
                            ack_no,
                            complaint_type,
                            source,
                            complaint_type AS match_type,
                            location,
                            COALESCE(transaction_amount, 0) AS transaction_amount,
                            status,
                            assigned_to
                        FROM case_master
                    
DEBUG: Final Dashboard Params: []
DEBUG: Fetched 12 rows for dashboard.
INFO:     121.242.232.133:7012 - "GET /api/case-list HTTP/1.1" 200 OK
INFO:     121.242.232.133:7012 - "GET /api/case/ACKNEW202518/customer-details HTTP/1.1" 200 OK
Fetched 2 documents from DB for ACK ACKNEW202518.
INFO:     121.242.232.133:47433 - "GET /api/case/ACKNEW202518/documents HTTP/1.1" 200 OK
INFO:     121.242.232.133:20785 - "GET /api/case/ACKNEW202518/decision HTTP/1.1" 200 OK
INFO:     121.242.232.133:7012 - "GET /api/case/ACKNEW202518/risk-profile HTTP/1.1" 200 OK
INFO:     121.242.232.133:57948 - "OPTIONS /api/case/ACKNEW202518/assign HTTP/1.1" 200 OK
DEBUG: Fetching user_type for user: 'shiva'
DEBUG: User 'shiva' has user_type: 'CRO'
Error in assign_case_api for case ACKNEW202518: name 'HTTPException' is not defined
Traceback (most recent call last):
  File "/home/ubuntu/FRD_Project/db/matcher.py", line 1447, in assign_case_to_employee
    return await self._execute_sync_db_op(_sync_assign_case)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ubuntu/FRD_Project/db/matcher.py", line 421, in _execute_sync_db_op
    return await asyncio.get_running_loop().run_in_executor(self.executor, func, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/home/ubuntu/FRD_Project/db/matcher.py", line 1379, in _sync_assign_case
    raise HTTPException(status_code=400, detail=f"CRO can only assign cases to 'risk_officer' users.")
          ^^^^^^^^^^^^^
NameError: name 'HTTPException' is not defined. Did you mean: 'BaseException'?

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/ubuntu/FRD_Project/routers/assignment.py", line 68, in assign_case_api
    success = await matcher.assign_case_to_employee(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "/home/ubuntu/FRD_Project/db/matcher.py", line 1448, in assign_case_to_employee
    except HTTPException:
           ^^^^^^^^^^^^^
NameError: name 'HTTPException' is not defined. Did you mean: 'BaseException'?
INFO:     121.242.232.133:13638 - "POST /api/case/ACKNEW202518/assign HTTP/1.1" 500 Internal Server Error
DEBUG: Fetching user_type for user: 'shiva'
DEBUG: User 'shiva' has user_type: 'CRO'
DEBUG: Dashboard: current_logged_in_username: 'shiva'
DEBUG: Dashboard: user_type_from_db for 'shiva': 'CRO'
DEBUG: Final Dashboard SQL: 
                        SELECT
                            ack_no,
                            complaint_type,
                            source,
                            complaint_type AS match_type,
                            location,
                            COALESCE(transaction_amount, 0) AS transaction_amount,
                            status,
                            assigned_to
                        FROM case_master
                    
DEBUG: Final Dashboard Params: []
DEBUG: Fetched 12 rows for dashboard.
INFO:     121.242.232.133:24264 - "GET /api/case-list HTTP/1.1" 200 OK
DEBUG: Fetching user_type for user: 'shiva'
DEBUG: User 'shiva' has user_type: 'CRO'
DEBUG: Dashboard: current_logged_in_username: 'shiva'
DEBUG: Dashboard: user_type_from_db for 'shiva': 'CRO'
DEBUG: Final Dashboard SQL: 
                        SELECT
                            ack_no,
                            complaint_type,
                            source,
                            complaint_type AS match_type,
                            location,
                            COALESCE(transaction_amount, 0) AS transaction_amount,
                            status,
                            assigned_to
                        FROM case_master
                    
DEBUG: Final Dashboard Params: []
DEBUG: Fetched 12 rows for dashboard.
INFO:     121.242.232.133:24264 - "GET /api/case-list HTTP/1.1" 200 OK
INFO:     121.242.232.133:24264 - "GET /api/case/ACKNEW202518/customer-details HTTP/1.1" 200 OK
Fetched 2 documents from DB for ACK ACKNEW202518.
INFO:     121.242.232.133:5598 - "GET /api/case/ACKNEW202518/documents HTTP/1.1" 200 OK
INFO:     121.242.232.133:42588 - "GET /api/case/ACKNEW202518/decision HTTP/1.1" 200 OK
INFO:     121.242.232.133:24264 - "GET /api/case/ACKNEW202518/risk-profile HTTP/1.1" 200 OK
INFO:     121.242.232.133:27612 - "POST /api/case/ACKNEW202518/assign HTTP/1.1" 401 Unauthorized
DEBUG: Fetching user_type for user: 'shiva'
DEBUG: User 'shiva' has user_type: 'CRO'
DEBUG: Dashboard: current_logged_in_username: 'shiva'
DEBUG: Dashboard: user_type_from_db for 'shiva': 'CRO'
DEBUG: Final Dashboard SQL: 
                        SELECT
                            ack_no,
                            complaint_type,
                            source,
                            complaint_type AS match_type,
                            location,
                            COALESCE(transaction_amount, 0) AS transaction_amount,
                            status,
                            assigned_to
                        FROM case_master
                    
DEBUG: Final Dashboard Params: []
DEBUG: Fetched 12 rows for dashboard.
INFO:     121.242.232.133:62513 - "GET /api/case-list HTTP/1.1" 200 OK
DEBUG: Fetching user_type for user: 'shiva'
DEBUG: User 'shiva' has user_type: 'CRO'
DEBUG: Dashboard: current_logged_in_username: 'shiva'
DEBUG: Dashboard: user_type_from_db for 'shiva': 'CRO'
DEBUG: Final Dashboard SQL: 
                        SELECT
                            ack_no,
                            complaint_type,
                            source,
                            complaint_type AS match_type,
                            location,
                            COALESCE(transaction_amount, 0) AS transaction_amount,
                            status,
                            assigned_to
                        FROM case_master
                    
DEBUG: Final Dashboard Params: []
DEBUG: Fetched 12 rows for dashboard.
INFO:     121.242.232.133:62513 - "GET /api/case-list HTTP/1.1" 200 OK
INFO:     121.242.232.133:62513 - "GET /api/case/ACKNEW6672/customer-details HTTP/1.1" 200 OK
Fetched 0 documents from DB for ACK ACKNEW6672.
INFO:     121.242.232.133:62272 - "GET /api/case/ACKNEW6672/documents HTTP/1.1" 200 OK
INFO:     121.242.232.133:20453 - "GET /api/case/ACKNEW6672/decision HTTP/1.1" 200 OK
INFO:     121.242.232.133:62513 - "GET /api/case/ACKNEW6672/risk-profile HTTP/1.1" 200 OK
INFO:     121.242.232.133:52998 - "OPTIONS /api/case/ACKNEW6672/assign HTTP/1.1" 200 OK
INFO:     121.242.232.133:52998 - "POST /api/case/ACKNEW6672/assign HTTP/1.1" 401 Unauthorized
DEBUG: Fetching user_type for user: 'shiva'
DEBUG: User 'shiva' has user_type: 'CRO'
DEBUG: Dashboard: current_logged_in_username: 'shiva'
DEBUG: Dashboard: user_type_from_db for 'shiva': 'CRO'
DEBUG: Final Dashboard SQL: 
                        SELECT
                            ack_no,
                            complaint_type,
                            source,
                            complaint_type AS match_type,
                            location,
                            COALESCE(transaction_amount, 0) AS transaction_amount,
                            status,
                            assigned_to
                        FROM case_master
                    
DEBUG: Final Dashboard Params: []
DEBUG: Fetched 12 rows for dashboard.
INFO:     121.242.232.133:46727 - "GET /api/case-list HTTP/1.1" 200 OK
DEBUG: Fetching user_type for user: 'shiva'
DEBUG: User 'shiva' has user_type: 'CRO'
DEBUG: Dashboard: current_logged_in_username: 'shiva'
DEBUG: Dashboard: user_type_from_db for 'shiva': 'CRO'
DEBUG: Final Dashboard SQL: 
                        SELECT
                            ack_no,
                            complaint_type,
                            source,
                            complaint_type AS match_type,
                            location,
                            COALESCE(transaction_amount, 0) AS transaction_amount,
                            status,
                            assigned_to
                        FROM case_master
                    
DEBUG: Final Dashboard Params: []
DEBUG: Fetched 12 rows for dashboard.
INFO:     121.242.232.133:46727 - "GET /api/case-list HTTP/1.1" 200 OK
INFO:     121.242.232.133:38936 - "GET /api/case/ACKNEW20250616_002/customer-details HTTP/1.1" 200 OK
Fetched 1 documents from DB for ACK ACKNEW20250616_002.
INFO:     121.242.232.133:45440 - "GET /api/case/ACKNEW20250616_002/documents HTTP/1.1" 200 OK
INFO:     121.242.232.133:23753 - "GET /api/case/ACKNEW20250616_002/decision HTTP/1.1" 200 OK
INFO:     121.242.232.133:38936 - "GET /api/case/ACKNEW20250616_002/risk-profile HTTP/1.1" 200 OK
WARNING:  StatReload detected changes in 'routers/auth.py'. Reloading...
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [3272086]
Process SpawnProcess-2:
Traceback (most recent call last):
  File "/usr/lib/python3.13/multiprocessing/process.py", line 313, in _bootstrap
    self.run()
    ~~~~~~~~^^
  File "/usr/lib/python3.13/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ubuntu/frdenv/lib/python3.13/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    ~~~~~~^^^^^^^^^^^^^^^^^
  File "/home/ubuntu/frdenv/lib/python3.13/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.13/asyncio/runners.py", line 195, in run
    return runner.run(main)
           ~~~~~~~~~~^^^^^^
  File "/usr/lib/python3.13/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/usr/lib/python3.13/asyncio/base_events.py", line 725, in run_until_complete
    return future.result()
           ~~~~~~~~~~~~~^^
  File "/home/ubuntu/frdenv/lib/python3.13/site-packages/uvicorn/server.py", line 70, in serve
    await self._serve(sockets)
  File "/home/ubuntu/frdenv/lib/python3.13/site-packages/uvicorn/server.py", line 77, in _serve
    config.load()
    ~~~~~~~~~~~^^
  File "/home/ubuntu/frdenv/lib/python3.13/site-packages/uvicorn/config.py", line 435, in load
    self.loaded_app = import_from_string(self.app)
                      ~~~~~~~~~~~~~~~~~~^^^^^^^^^^
  File "/home/ubuntu/frdenv/lib/python3.13/site-packages/uvicorn/importer.py", line 19, in import_from_string
    module = importlib.import_module(module_str)
  File "/usr/lib/python3.13/importlib/__init__.py", line 88, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen importlib._bootstrap>", line 1387, in _gcd_import
  File "<frozen importlib._bootstrap>", line 1360, in _find_and_load
  File "<frozen importlib._bootstrap>", line 1331, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 935, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 1026, in exec_module
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/ubuntu/FRD_Project/main.py", line 18, in <module>
    from routers import (
    ...<11 lines>...
    )
  File "/home/ubuntu/FRD_Project/routers/auth.py", line 31, in <module>
    keycloak_openid_instance: Annotated[KeycloakOpenID, Depends(get_keycloak_openid_instance)],
                              ^^^^^^^^^
NameError: name 'Annotated' is not defined
INFO:     Will watch for changes in these directories: ['/home/ubuntu/FRD_Project']
INFO:     Uvicorn running on http://0.0.0.0:9000 (Press CTRL+C to quit)
INFO:     Started reloader process [3624206] using StatReload
INFO:     Started server process [3624208]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
ThreadPoolExecutor initialized.
✅ AnomalyDetector initialized. (Placeholder for model loading).
✅ AnomalyDetector initialized. (Placeholder for model loading).
FastAPI application startup complete.
INFO:     121.242.232.133:3689 - "OPTIONS /api/login HTTP/1.1" 200 OK
DEBUG: Fetching user_type for user: 'jalaj'
DEBUG: User 'jalaj' has user_type: 'risk_officer'
INFO:     121.242.232.133:21611 - "POST /api/login HTTP/1.1" 200 OK
DEBUG: Fetching user_type for user: 'shiva'
DEBUG: User 'shiva' has user_type: 'CRO'
INFO:     121.242.232.133:7328 - "POST /api/login HTTP/1.1" 200 OK
INFO:     121.242.232.133:22485 - "OPTIONS /api/case-list HTTP/1.1" 200 OK
DEBUG: Fetching user_type for user: 'shiva'
DEBUG: User 'shiva' has user_type: 'CRO'
DEBUG: Dashboard: current_logged_in_username: 'shiva'
DEBUG: Dashboard: user_type_from_db for 'shiva': 'CRO'
DEBUG: Final Dashboard SQL: 
                        SELECT
                            ack_no,
                            complaint_type,
                            source,
                            complaint_type AS match_type,
                            location,
                            COALESCE(transaction_amount, 0) AS transaction_amount,
                            status,
                            assigned_to
                        FROM case_master
                    
DEBUG: Final Dashboard Params: []
DEBUG: Fetched 12 rows for dashboard.
INFO:     121.242.232.133:22485 - "GET /api/case-list HTTP/1.1" 200 OK
DEBUG: Fetching user_type for user: 'shiva'
DEBUG: User 'shiva' has user_type: 'CRO'
DEBUG: Dashboard: current_logged_in_username: 'shiva'
DEBUG: Dashboard: user_type_from_db for 'shiva': 'CRO'
DEBUG: Final Dashboard SQL: 
                        SELECT
                            ack_no,
                            complaint_type,
                            source,
                            complaint_type AS match_type,
                            location,
                            COALESCE(transaction_amount, 0) AS transaction_amount,
                            status,
                            assigned_to
                        FROM case_master
                    
DEBUG: Final Dashboard Params: []
DEBUG: Fetched 12 rows for dashboard.
INFO:     121.242.232.133:29569 - "GET /api/case-list HTTP/1.1" 200 OK
INFO:     121.242.232.133:49527 - "OPTIONS /api/case-entry HTTP/1.1" 200 OK
INFO:     121.242.232.133:3938 - "POST /api/case-entry HTTP/1.1" 422 Unprocessable Content
INFO:     121.242.232.133:11245 - "POST /api/case-entry HTTP/1.1" 422 Unprocessable Content
INFO:     121.242.232.133:19376 - "GET /api/case-entry HTTP/1.1" 405 Method Not Allowed
Victim result from DB: RealDictRow({'cust_id': 'CUST107331'})
Beneficiary result from DB: None
DEBUG: At this point, victim_cust_id: CUST107331, beneficiary_cust_id: None
Inserting into case_entry_form...
✅ Evidence file saved to: /home/ubuntu/fraud_uploads/ACK12345678_a8a41839-d0a8-4d63-870a-e4c85274a569.numbers
❌ Error inserting into case_entry_form for ack_no ACK12345678: numeric field overflow
DETAIL:  A field with precision 15, scale 2 must round to an absolute value less than 10^13.

INFO:     121.242.232.133:35844 - "POST /api/case-entry HTTP/1.1" 400 Bad Request
Victim result from DB: RealDictRow({'cust_id': 'CUST107331'})
Beneficiary result from DB: None
DEBUG: At this point, victim_cust_id: CUST107331, beneficiary_cust_id: None
Inserting into case_entry_form...
✅ Evidence file saved to: /home/ubuntu/fraud_uploads/ACK12345678_1f1979f8-9d06-4960-ad56-d3e1c7ccc0d6.numbers
✅ Case_entry_form committed to the database.
case_master entry created with case_id: 69
Inserting victim details into case_detail...
ℹ️ No beneficiary match found. Skipping decision API call and case_decisions insertion.

--- Finalizing match_data processing ---
INFO:     121.242.232.133:4209 - "POST /api/case-entry HTTP/1.1" 200 OK
INFO:     121.242.232.133:28254 - "OPTIONS /api/case-list HTTP/1.1" 200 OK
UNEXPECTED ERROR in get_current_username: Expired at 1751446107, time: 1751446759(leeway: 60)
Traceback (most recent call last):
  File "/home/ubuntu/FRD_Project/routers/dashboard.py", line 26, in get_current_username
    decoded_token = keycloak_openid_instance.decode_token(token)
  File "/home/ubuntu/frdenv/lib/python3.13/site-packages/keycloak/keycloak_openid.py", line 691, in decode_token
    return self._verify_token(token, key, **kwargs)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ubuntu/frdenv/lib/python3.13/site-packages/keycloak/keycloak_openid.py", line 650, in _verify_token
    full_jwt.validate(key)
    ~~~~~~~~~~~~~~~~~^^^^^
  File "/home/ubuntu/frdenv/lib/python3.13/site-packages/jwcrypto/jwt.py", line 651, in validate
    self._check_provided_claims()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/ubuntu/frdenv/lib/python3.13/site-packages/jwcrypto/jwt.py", line 504, in _check_provided_claims
    self._check_default_claims(claims)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/home/ubuntu/frdenv/lib/python3.13/site-packages/jwcrypto/jwt.py", line 474, in _check_default_claims
    self._check_exp(claims['exp'], time.time(), self._leeway)
    ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ubuntu/frdenv/lib/python3.13/site-packages/jwcrypto/jwt.py", line 454, in _check_exp
    raise JWTExpired('Expired at %d, time: %d(leeway: %d)' % (
                     claim, limit, leeway))
jwcrypto.jwt.JWTExpired: Expired at 1751446107, time: 1751446759(leeway: 60)
INFO:     121.242.232.133:28254 - "GET /api/case-list HTTP/1.1" 500 Internal Server Error
INFO:     121.242.232.133:44544 - "OPTIONS /api/login HTTP/1.1" 200 OK
DEBUG: Fetching user_type for user: 'shiva'
DEBUG: User 'shiva' has user_type: 'CRO'
INFO:     121.242.232.133:44544 - "POST /api/login HTTP/1.1" 200 OK
DEBUG: Fetching user_type for user: 'shiva'
DEBUG: User 'shiva' has user_type: 'CRO'
DEBUG: Dashboard: current_logged_in_username: 'shiva'
DEBUG: Dashboard: user_type_from_db for 'shiva': 'CRO'
DEBUG: Final Dashboard SQL: 
                        SELECT
                            ack_no,
                            complaint_type,
                            source,
                            complaint_type AS match_type,
                            location,
                            COALESCE(transaction_amount, 0) AS transaction_amount,
                            status,
                            assigned_to
                        FROM case_master
                    
DEBUG: Final Dashboard Params: []
DEBUG: Fetched 13 rows for dashboard.
INFO:     121.242.232.133:44544 - "GET /api/case-list HTTP/1.1" 200 OK
INFO:     121.242.232.133:28566 - "OPTIONS /api/case/ACKNEW123/decision HTTP/1.1" 200 OK
INFO:     121.242.232.133:11809 - "OPTIONS /api/case/ACKNEW123/documents HTTP/1.1" 200 OK
INFO:     121.242.232.133:31433 - "OPTIONS /api/case/ACKNEW123/decision HTTP/1.1" 200 OK
INFO:     121.242.232.133:16292 - "OPTIONS /api/case/ACKNEW123/customer-details HTTP/1.1" 200 OK
DEBUG DB: Attempting to fetch documents for ACK ACKNEW123 directly.
ERROR DB: Failed to fetch documents directly: '_GeneratorContextManager' object has no attribute 'cursor'
Traceback (most recent call last):
  File "/home/ubuntu/FRD_Project/db/matcher.py", line 119, in get_uploaded_documents
    cur = conn.cursor()        # <--- DIRECT SYNCHRONOUS CALL
          ^^^^^^^^^^^
AttributeError: '_GeneratorContextManager' object has no attribute 'cursor'
Failed to fetch documents: '_GeneratorContextManager' object has no attribute 'close'
Traceback (most recent call last):
  File "/home/ubuntu/FRD_Project/routers/document.py", line 135, in get_documents_api
    documents = await get_uploaded_documents(ack_no) # <-- Call without executor
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ubuntu/FRD_Project/db/matcher.py", line 134, in get_uploaded_documents
    conn.close() # Ensure connection is closed
    ^^^^^^^^^^
AttributeError: '_GeneratorContextManager' object has no attribute 'close'
INFO:     121.242.232.133:16292 - "GET /api/case/ACKNEW123/documents HTTP/1.1" 500 Internal Server Error
INFO:     121.242.232.133:11809 - "GET /api/case/ACKNEW123/customer-details HTTP/1.1" 200 OK
INFO:     121.242.232.133:23136 - "GET /api/case/ACKNEW123/decision HTTP/1.1" 200 OK
INFO:     121.242.232.133:16292 - "GET /api/case/ACKNEW123/decision HTTP/1.1" 200 OK
INFO:     121.242.232.133:11809 - "OPTIONS /api/case/ACKNEW123/risk-profile HTTP/1.1" 200 OK
Traceback (most recent call last):
  File "/home/ubuntu/FRD_Project/routers/transaction.py", line 90, in get_risk_entity_profile
    raise HTTPException(status_code=404, detail="Risk profiles not found for this Acknowledgement No.")
fastapi.exceptions.HTTPException: 404: Risk profiles not found for this Acknowledgement No.
Error fetching risk profile for ACK No ACKNEW123: 404: Risk profiles not found for this Acknowledgement No.
INFO:     121.242.232.133:23136 - "GET /api/case/ACKNEW123/risk-profile HTTP/1.1" 500 Internal Server Error
DEBUG: Fetching user_type for user: 'shiva'
DEBUG: User 'shiva' has user_type: 'CRO'
DEBUG: Dashboard: current_logged_in_username: 'shiva'
DEBUG: Dashboard: user_type_from_db for 'shiva': 'CRO'
DEBUG: Final Dashboard SQL: 
                        SELECT
                            ack_no,
                            complaint_type,
                            source,
                            complaint_type AS match_type,
                            location,
                            COALESCE(transaction_amount, 0) AS transaction_amount,
                            status,
                            assigned_to
                        FROM case_master
                    
DEBUG: Final Dashboard Params: []
DEBUG: Fetched 13 rows for dashboard.
INFO:     121.242.232.133:42336 - "GET /api/case-list HTTP/1.1" 200 OK
INFO:     121.242.232.133:46736 - "OPTIONS /api/case/ACK12345678/customer-details HTTP/1.1" 200 OK
INFO:     121.242.232.133:52297 - "OPTIONS /api/case/ACK12345678/documents HTTP/1.1" 200 OK
INFO:     121.242.232.133:22469 - "OPTIONS /api/case/ACK12345678/decision HTTP/1.1" 200 OK
INFO:     121.242.232.133:61456 - "OPTIONS /api/case/ACK12345678/decision HTTP/1.1" 200 OK
DEBUG DB: Attempting to fetch documents for ACK ACK12345678 directly.
ERROR DB: Failed to fetch documents directly: '_GeneratorContextManager' object has no attribute 'cursor'
Traceback (most recent call last):
  File "/home/ubuntu/FRD_Project/db/matcher.py", line 119, in get_uploaded_documents
    cur = conn.cursor()        # <--- DIRECT SYNCHRONOUS CALL
          ^^^^^^^^^^^
AttributeError: '_GeneratorContextManager' object has no attribute 'cursor'
Failed to fetch documents: '_GeneratorContextManager' object has no attribute 'close'
Traceback (most recent call last):
  File "/home/ubuntu/FRD_Project/routers/document.py", line 135, in get_documents_api
    documents = await get_uploaded_documents(ack_no) # <-- Call without executor
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ubuntu/FRD_Project/db/matcher.py", line 134, in get_uploaded_documents
    conn.close() # Ensure connection is closed
    ^^^^^^^^^^
AttributeError: '_GeneratorContextManager' object has no attribute 'close'
INFO:     121.242.232.133:52297 - "GET /api/case/ACK12345678/documents HTTP/1.1" 500 Internal Server Error
INFO:     121.242.232.133:46736 - "GET /api/case/ACK12345678/customer-details HTTP/1.1" 200 OK
No stored decision found for ACK No ACK12345678. Calling classification model...
Model classified: Normal - Transaction within typical parameters (example rule).
✅ Decision record for ACK12345678 saved/updated in case_decisions.
INFO:     121.242.232.133:52979 - "GET /api/case/ACK12345678/decision HTTP/1.1" 200 OK
INFO:     121.242.232.133:46736 - "OPTIONS /api/case/ACK12345678/risk-profile HTTP/1.1" 200 OK
INFO:     121.242.232.133:52297 - "GET /api/case/ACK12345678/decision HTTP/1.1" 200 OK
INFO:     121.242.232.133:61456 - "GET /api/case/ACK12345678/risk-profile HTTP/1.1" 200 OK
DEBUG: Fetching user_type for user: 'shiva'
DEBUG: User 'shiva' has user_type: 'CRO'
DEBUG: Dashboard: current_logged_in_username: 'shiva'
DEBUG: Dashboard: user_type_from_db for 'shiva': 'CRO'
DEBUG: Final Dashboard SQL: 
                        SELECT
                            ack_no,
                            complaint_type,
                            source,
                            complaint_type AS match_type,
                            location,
                            COALESCE(transaction_amount, 0) AS transaction_amount,
                            status,
                            assigned_to
                        FROM case_master
                    
DEBUG: Final Dashboard Params: []
DEBUG: Fetched 13 rows for dashboard.
INFO:     121.242.232.133:28077 - "GET /api/case-list HTTP/1.1" 200 OK
INFO:     121.242.232.133:28077 - "GET /api/case/ACK12345678/customer-details HTTP/1.1" 200 OK
DEBUG DB: Attempting to fetch documents for ACK ACK12345678 directly.
ERROR DB: Failed to fetch documents directly: '_GeneratorContextManager' object has no attribute 'cursor'
Traceback (most recent call last):
  File "/home/ubuntu/FRD_Project/db/matcher.py", line 119, in get_uploaded_documents
    cur = conn.cursor()        # <--- DIRECT SYNCHRONOUS CALL
          ^^^^^^^^^^^
AttributeError: '_GeneratorContextManager' object has no attribute 'cursor'
Failed to fetch documents: '_GeneratorContextManager' object has no attribute 'close'
Traceback (most recent call last):
  File "/home/ubuntu/FRD_Project/routers/document.py", line 135, in get_documents_api
    documents = await get_uploaded_documents(ack_no) # <-- Call without executor
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ubuntu/FRD_Project/db/matcher.py", line 134, in get_uploaded_documents
    conn.close() # Ensure connection is closed
    ^^^^^^^^^^
AttributeError: '_GeneratorContextManager' object has no attribute 'close'
INFO:     121.242.232.133:2190 - "GET /api/case/ACK12345678/documents HTTP/1.1" 500 Internal Server Error
INFO:     121.242.232.133:23663 - "GET /api/case/ACK12345678/decision HTTP/1.1" 200 OK
INFO:     121.242.232.133:28077 - "GET /api/case/ACK12345678/risk-profile HTTP/1.1" 200 OK
INFO:     121.242.232.133:2190 - "GET /api/case/ACK12345678/decision HTTP/1.1" 200 OK
INFO:     121.242.232.133:62692 - "OPTIONS /api/case/ACK12345678/operations-status HTTP/1.1" 200 OK
INFO:     121.242.232.133:62692 - "GET /api/case/ACK12345678/operations-status HTTP/1.1" 404 Not Found
INFO:     121.242.232.133:28288 - "GET /api/case/ACK12345678/operations-status HTTP/1.1" 404 Not Found
INFO:     121.242.232.133:16572 - "OPTIONS /api/case/ACK12345678/assign HTTP/1.1" 200 OK
UNEXPECTED ERROR in get_current_username: Expired at 1751447070, time: 1751447499(leeway: 60)
Traceback (most recent call last):
  File "/home/ubuntu/FRD_Project/routers/assignment.py", line 30, in get_current_username
    decoded_token = keycloak_openid_instance.decode_token(token)
  File "/home/ubuntu/frdenv/lib/python3.13/site-packages/keycloak/keycloak_openid.py", line 691, in decode_token
    return self._verify_token(token, key, **kwargs)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ubuntu/frdenv/lib/python3.13/site-packages/keycloak/keycloak_openid.py", line 650, in _verify_token
    full_jwt.validate(key)
    ~~~~~~~~~~~~~~~~~^^^^^
  File "/home/ubuntu/frdenv/lib/python3.13/site-packages/jwcrypto/jwt.py", line 651, in validate
    self._check_provided_claims()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/ubuntu/frdenv/lib/python3.13/site-packages/jwcrypto/jwt.py", line 504, in _check_provided_claims
    self._check_default_claims(claims)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/home/ubuntu/frdenv/lib/python3.13/site-packages/jwcrypto/jwt.py", line 474, in _check_default_claims
    self._check_exp(claims['exp'], time.time(), self._leeway)
    ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ubuntu/frdenv/lib/python3.13/site-packages/jwcrypto/jwt.py", line 454, in _check_exp
    raise JWTExpired('Expired at %d, time: %d(leeway: %d)' % (
                     claim, limit, leeway))
jwcrypto.jwt.JWTExpired: Expired at 1751447070, time: 1751447499(leeway: 60)
INFO:     121.242.232.133:52962 - "POST /api/case/ACK12345678/assign HTTP/1.1" 500 Internal Server Error
INFO:     121.242.232.133:52177 - "OPTIONS /api/case-list HTTP/1.1" 200 OK
UNEXPECTED ERROR in get_current_username: Expired at 1751447070, time: 1751447526(leeway: 60)
Traceback (most recent call last):
  File "/home/ubuntu/FRD_Project/routers/dashboard.py", line 26, in get_current_username
    decoded_token = keycloak_openid_instance.decode_token(token)
  File "/home/ubuntu/frdenv/lib/python3.13/site-packages/keycloak/keycloak_openid.py", line 691, in decode_token
    return self._verify_token(token, key, **kwargs)
           ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ubuntu/frdenv/lib/python3.13/site-packages/keycloak/keycloak_openid.py", line 650, in _verify_token
    full_jwt.validate(key)
    ~~~~~~~~~~~~~~~~~^^^^^
  File "/home/ubuntu/frdenv/lib/python3.13/site-packages/jwcrypto/jwt.py", line 651, in validate
    self._check_provided_claims()
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/ubuntu/frdenv/lib/python3.13/site-packages/jwcrypto/jwt.py", line 504, in _check_provided_claims
    self._check_default_claims(claims)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/home/ubuntu/frdenv/lib/python3.13/site-packages/jwcrypto/jwt.py", line 474, in _check_default_claims
    self._check_exp(claims['exp'], time.time(), self._leeway)
    ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ubuntu/frdenv/lib/python3.13/site-packages/jwcrypto/jwt.py", line 454, in _check_exp
    raise JWTExpired('Expired at %d, time: %d(leeway: %d)' % (
                     claim, limit, leeway))
jwcrypto.jwt.JWTExpired: Expired at 1751447070, time: 1751447526(leeway: 60)
INFO:     121.242.232.133:6513 - "GET /api/case-list HTTP/1.1" 500 Internal Server Error
INFO:     121.242.232.133:54963 - "OPTIONS /api/login HTTP/1.1" 200 OK
DEBUG: Fetching user_type for user: 'shiva'
DEBUG: User 'shiva' has user_type: 'CRO'
INFO:     121.242.232.133:18796 - "POST /api/login HTTP/1.1" 200 OK
DEBUG: Fetching user_type for user: 'shiva'
DEBUG: User 'shiva' has user_type: 'CRO'
DEBUG: Dashboard: current_logged_in_username: 'shiva'
DEBUG: Dashboard: user_type_from_db for 'shiva': 'CRO'
DEBUG: Final Dashboard SQL: 
                        SELECT
                            ack_no,
                            complaint_type,
                            source,
                            complaint_type AS match_type,
                            location,
                            COALESCE(transaction_amount, 0) AS transaction_amount,
                            status,
                            assigned_to
                        FROM case_master
                    
DEBUG: Final Dashboard Params: []
DEBUG: Fetched 13 rows for dashboard.
INFO:     121.242.232.133:18796 - "GET /api/case-list HTTP/1.1" 200 OK
INFO:     121.242.232.133:3449 - "OPTIONS /api/case/ACK12345678/customer-details HTTP/1.1" 200 OK
INFO:     121.242.232.133:1727 - "OPTIONS /api/case/ACK12345678/documents HTTP/1.1" 200 OK
INFO:     121.242.232.133:16119 - "OPTIONS /api/case/ACK12345678/decision HTTP/1.1" 200 OK
INFO:     121.242.232.133:43218 - "OPTIONS /api/case/ACK12345678/decision HTTP/1.1" 200 OK
DEBUG DB: Attempting to fetch documents for ACK ACK12345678 directly.
ERROR DB: Failed to fetch documents directly: '_GeneratorContextManager' object has no attribute 'cursor'
Traceback (most recent call last):
  File "/home/ubuntu/FRD_Project/db/matcher.py", line 119, in get_uploaded_documents
    cur = conn.cursor()        # <--- DIRECT SYNCHRONOUS CALL
          ^^^^^^^^^^^
AttributeError: '_GeneratorContextManager' object has no attribute 'cursor'
Failed to fetch documents: '_GeneratorContextManager' object has no attribute 'close'
Traceback (most recent call last):
  File "/home/ubuntu/FRD_Project/routers/document.py", line 135, in get_documents_api
    documents = await get_uploaded_documents(ack_no) # <-- Call without executor
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ubuntu/FRD_Project/db/matcher.py", line 134, in get_uploaded_documents
    conn.close() # Ensure connection is closed
    ^^^^^^^^^^
AttributeError: '_GeneratorContextManager' object has no attribute 'close'
INFO:     121.242.232.133:16641 - "GET /api/case/ACK12345678/documents HTTP/1.1" 500 Internal Server Error
INFO:     121.242.232.133:3449 - "GET /api/case/ACK12345678/customer-details HTTP/1.1" 200 OK
INFO:     121.242.232.133:10695 - "GET /api/case/ACK12345678/decision HTTP/1.1" 200 OK
INFO:     121.242.232.133:3449 - "OPTIONS /api/case/ACK12345678/risk-profile HTTP/1.1" 200 OK
INFO:     121.242.232.133:16641 - "GET /api/case/ACK12345678/decision HTTP/1.1" 200 OK
INFO:     121.242.232.133:10695 - "GET /api/case/ACK12345678/risk-profile HTTP/1.1" 200 OK
DEBUG: Fetching user_type for user: 'shiva'
DEBUG: User 'shiva' has user_type: 'CRO'
✅ Decision record for ACK12345678 saved/updated in case_decisions.
INFO:     121.242.232.133:43294 - "POST /api/case/ACK12345678/assign HTTP/1.1" 200 OK
DEBUG: Fetching user_type for user: 'shiva'
DEBUG: User 'shiva' has user_type: 'CRO'
DEBUG: Dashboard: current_logged_in_username: 'shiva'
DEBUG: Dashboard: user_type_from_db for 'shiva': 'CRO'
DEBUG: Final Dashboard SQL: 
                        SELECT
                            ack_no,
                            complaint_type,
                            source,
                            complaint_type AS match_type,
                            location,
                            COALESCE(transaction_amount, 0) AS transaction_amount,
                            status,
                            assigned_to
                        FROM case_master
                    
DEBUG: Final Dashboard Params: []
DEBUG: Fetched 13 rows for dashboard.
INFO:     121.242.232.133:1400 - "GET /api/case-list HTTP/1.1" 200 OK
DEBUG DB: Attempting to fetch documents for ACK ACK12345678 directly.
ERROR DB: Failed to fetch documents directly: '_GeneratorContextManager' object has no attribute 'cursor'
Traceback (most recent call last):
  File "/home/ubuntu/FRD_Project/db/matcher.py", line 119, in get_uploaded_documents
    cur = conn.cursor()        # <--- DIRECT SYNCHRONOUS CALL
          ^^^^^^^^^^^
AttributeError: '_GeneratorContextManager' object has no attribute 'cursor'
Failed to fetch documents: '_GeneratorContextManager' object has no attribute 'close'
Traceback (most recent call last):
  File "/home/ubuntu/FRD_Project/routers/document.py", line 135, in get_documents_api
    documents = await get_uploaded_documents(ack_no) # <-- Call without executor
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ubuntu/FRD_Project/db/matcher.py", line 134, in get_uploaded_documents
    conn.close() # Ensure connection is closed
    ^^^^^^^^^^
AttributeError: '_GeneratorContextManager' object has no attribute 'close'
INFO:     121.242.232.133:32128 - "GET /api/case/ACK12345678/documents HTTP/1.1" 500 Internal Server Error
INFO:     121.242.232.133:64670 - "GET /api/case/ACK12345678/customer-details HTTP/1.1" 200 OK
INFO:     121.242.232.133:45500 - "GET /api/case/ACK12345678/decision HTTP/1.1" 200 OK
INFO:     121.242.232.133:32128 - "GET /api/case/ACK12345678/decision HTTP/1.1" 200 OK
INFO:     121.242.232.133:45500 - "GET /api/case/ACK12345678/risk-profile HTTP/1.1" 200 OK
INFO:     121.242.232.133:56792 - "GET /api/case/ACK12345678/operations-status HTTP/1.1" 404 Not Found
INFO:     121.242.232.133:10704 - "GET /api/case/ACK12345678/operations-status HTTP/1.1" 404 Not Found
DEBUG: Fetching user_type for user: 'jalaj'
DEBUG: User 'jalaj' has user_type: 'risk_officer'
INFO:     121.242.232.133:54914 - "POST /api/login HTTP/1.1" 200 OK
DEBUG: Fetching user_type for user: 'jalaj'
DEBUG: User 'jalaj' has user_type: 'risk_officer'
DEBUG: Dashboard: current_logged_in_username: 'jalaj'
DEBUG: Dashboard: user_type_from_db for 'jalaj': 'risk_officer'
DEBUG: Final Dashboard SQL: 
                        SELECT
                            ack_no,
                            complaint_type,
                            source,
                            complaint_type AS match_type,
                            location,
                            COALESCE(transaction_amount, 0) AS transaction_amount,
                            status,
                            assigned_to
                        FROM case_master
                     WHERE assigned_to = %s
DEBUG: Final Dashboard Params: ['jalaj']
DEBUG: Fetched 2 rows for dashboard.
INFO:     121.242.232.133:35570 - "GET /api/case-list HTTP/1.1" 200 OK
INFO:     121.242.232.133:45199 - "GET /api/case/ACK12345678/customer-details HTTP/1.1" 200 OK
DEBUG DB: Attempting to fetch documents for ACK ACK12345678 directly.
ERROR DB: Failed to fetch documents directly: '_GeneratorContextManager' object has no attribute 'cursor'
Traceback (most recent call last):
  File "/home/ubuntu/FRD_Project/db/matcher.py", line 119, in get_uploaded_documents
    cur = conn.cursor()        # <--- DIRECT SYNCHRONOUS CALL
          ^^^^^^^^^^^
AttributeError: '_GeneratorContextManager' object has no attribute 'cursor'
Failed to fetch documents: '_GeneratorContextManager' object has no attribute 'close'
Traceback (most recent call last):
  File "/home/ubuntu/FRD_Project/routers/document.py", line 135, in get_documents_api
    documents = await get_uploaded_documents(ack_no) # <-- Call without executor
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ubuntu/FRD_Project/db/matcher.py", line 134, in get_uploaded_documents
    conn.close() # Ensure connection is closed
    ^^^^^^^^^^
AttributeError: '_GeneratorContextManager' object has no attribute 'close'
INFO:     121.242.232.133:63076 - "GET /api/case/ACK12345678/documents HTTP/1.1" 500 Internal Server Error
INFO:     121.242.232.133:48952 - "GET /api/case/ACK12345678/decision HTTP/1.1" 200 OK
INFO:     121.242.232.133:45199 - "GET /api/case/ACK12345678/risk-profile HTTP/1.1" 200 OK
INFO:     121.242.232.133:63076 - "GET /api/case/ACK12345678/decision HTTP/1.1" 200 OK
DEBUG: Fetching user_type for user: 'jalaj'
DEBUG: User 'jalaj' has user_type: 'risk_officer'
✅ Decision record for ACK12345678 saved/updated in case_decisions.
INFO:     121.242.232.133:45469 - "POST /api/case/ACK12345678/assign HTTP/1.1" 200 OK
DEBUG: Fetching user_type for user: 'jalaj'
DEBUG: User 'jalaj' has user_type: 'risk_officer'
DEBUG: Dashboard: current_logged_in_username: 'jalaj'
DEBUG: Dashboard: user_type_from_db for 'jalaj': 'risk_officer'
DEBUG: Final Dashboard SQL: 
                        SELECT
                            ack_no,
                            complaint_type,
                            source,
                            complaint_type AS match_type,
                            location,
                            COALESCE(transaction_amount, 0) AS transaction_amount,
                            status,
                            assigned_to
                        FROM case_master
                     WHERE assigned_to = %s
DEBUG: Final Dashboard Params: ['jalaj']
DEBUG: Fetched 1 rows for dashboard.
INFO:     121.242.232.133:45364 - "GET /api/case-list HTTP/1.1" 200 OK
DEBUG: Fetching user_type for user: 'vaishnavi'
DEBUG: User 'vaishnavi' has user_type: 'others'
INFO:     121.242.232.133:42813 - "POST /api/login HTTP/1.1" 200 OK
DEBUG: Fetching user_type for user: 'vaishnavi'
DEBUG: User 'vaishnavi' has user_type: 'others'
DEBUG: Dashboard: current_logged_in_username: 'vaishnavi'
DEBUG: Dashboard: user_type_from_db for 'vaishnavi': 'others'
DEBUG: Final Dashboard SQL: 
                        SELECT
                            ack_no,
                            complaint_type,
                            source,
                            complaint_type AS match_type,
                            location,
                            COALESCE(transaction_amount, 0) AS transaction_amount,
                            status,
                            assigned_to
                        FROM case_master
                     WHERE assigned_to = %s
DEBUG: Final Dashboard Params: ['vaishnavi']
DEBUG: Fetched 2 rows for dashboard.
INFO:     121.242.232.133:42813 - "GET /api/case-list HTTP/1.1" 200 OK
INFO:     121.242.232.133:6532 - "OPTIONS /api/case/ACKNEW202518/customer-details HTTP/1.1" 200 OK
INFO:     121.242.232.133:40994 - "OPTIONS /api/case/ACKNEW202518/documents HTTP/1.1" 200 OK
INFO:     121.242.232.133:58306 - "OPTIONS /api/case/ACKNEW202518/decision HTTP/1.1" 200 OK
INFO:     121.242.232.133:63810 - "OPTIONS /api/case/ACKNEW202518/decision HTTP/1.1" 200 OK
DEBUG DB: Attempting to fetch documents for ACK ACKNEW202518 directly.
ERROR DB: Failed to fetch documents directly: '_GeneratorContextManager' object has no attribute 'cursor'
Traceback (most recent call last):
  File "/home/ubuntu/FRD_Project/db/matcher.py", line 119, in get_uploaded_documents
    cur = conn.cursor()        # <--- DIRECT SYNCHRONOUS CALL
          ^^^^^^^^^^^
AttributeError: '_GeneratorContextManager' object has no attribute 'cursor'
Failed to fetch documents: '_GeneratorContextManager' object has no attribute 'close'
Traceback (most recent call last):
  File "/home/ubuntu/FRD_Project/routers/document.py", line 135, in get_documents_api
    documents = await get_uploaded_documents(ack_no) # <-- Call without executor
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ubuntu/FRD_Project/db/matcher.py", line 134, in get_uploaded_documents
    conn.close() # Ensure connection is closed
    ^^^^^^^^^^
AttributeError: '_GeneratorContextManager' object has no attribute 'close'
INFO:     121.242.232.133:40994 - "GET /api/case/ACKNEW202518/documents HTTP/1.1" 500 Internal Server Error
INFO:     121.242.232.133:58306 - "GET /api/case/ACKNEW202518/decision HTTP/1.1" 200 OK
INFO:     121.242.232.133:6532 - "GET /api/case/ACKNEW202518/customer-details HTTP/1.1" 200 OK
INFO:     121.242.232.133:40994 - "GET /api/case/ACKNEW202518/decision HTTP/1.1" 200 OK
INFO:     121.242.232.133:58306 - "OPTIONS /api/case/ACKNEW202518/risk-profile HTTP/1.1" 200 OK
INFO:     121.242.232.133:6532 - "GET /api/case/ACKNEW202518/risk-profile HTTP/1.1" 200 OK
INFO:     121.242.232.133:50566 - "OPTIONS /api/case-list HTTP/1.1" 200 OK
DEBUG: Fetching user_type for user: 'vaishnavi'
DEBUG: User 'vaishnavi' has user_type: 'others'
DEBUG: Dashboard: current_logged_in_username: 'vaishnavi'
DEBUG: Dashboard: user_type_from_db for 'vaishnavi': 'others'
DEBUG: Final Dashboard SQL: 
                        SELECT
                            ack_no,
                            complaint_type,
                            source,
                            complaint_type AS match_type,
                            location,
                            COALESCE(transaction_amount, 0) AS transaction_amount,
                            status,
                            assigned_to
                        FROM case_master
                     WHERE assigned_to = %s
DEBUG: Final Dashboard Params: ['vaishnavi']
DEBUG: Fetched 2 rows for dashboard.
INFO:     121.242.232.133:50566 - "GET /api/case-list HTTP/1.1" 200 OK
INFO:     121.242.232.133:48358 - "OPTIONS /api/login HTTP/1.1" 200 OK
DEBUG: Fetching user_type for user: 'shiva'
DEBUG: User 'shiva' has user_type: 'CRO'
INFO:     121.242.232.133:48358 - "POST /api/login HTTP/1.1" 200 OK
DEBUG: Fetching user_type for user: 'shiva'
DEBUG: User 'shiva' has user_type: 'CRO'
DEBUG: Dashboard: current_logged_in_username: 'shiva'
DEBUG: Dashboard: user_type_from_db for 'shiva': 'CRO'
DEBUG: Final Dashboard SQL: 
                        SELECT
                            ack_no,
                            complaint_type,
                            source,
                            complaint_type AS match_type,
                            location,
                            COALESCE(transaction_amount, 0) AS transaction_amount,
                            status,
                            assigned_to
                        FROM case_master
                    
DEBUG: Final Dashboard Params: []
DEBUG: Fetched 13 rows for dashboard.
INFO:     121.242.232.133:48358 - "GET /api/case-list HTTP/1.1" 200 OK
INFO:     121.242.232.133:5629 - "OPTIONS /api/case/ACK12345678/documents HTTP/1.1" 200 OK
INFO:     121.242.232.133:47680 - "OPTIONS /api/case/ACK12345678/decision HTTP/1.1" 200 OK
INFO:     121.242.232.133:65128 - "OPTIONS /api/case/ACK12345678/customer-details HTTP/1.1" 200 OK
INFO:     121.242.232.133:39255 - "OPTIONS /api/case/ACK12345678/decision HTTP/1.1" 200 OK
DEBUG DB: Attempting to fetch documents for ACK ACK12345678 directly.
ERROR DB: Failed to fetch documents directly: '_GeneratorContextManager' object has no attribute 'cursor'
Traceback (most recent call last):
  File "/home/ubuntu/FRD_Project/db/matcher.py", line 119, in get_uploaded_documents
    cur = conn.cursor()        # <--- DIRECT SYNCHRONOUS CALL
          ^^^^^^^^^^^
AttributeError: '_GeneratorContextManager' object has no attribute 'cursor'
Failed to fetch documents: '_GeneratorContextManager' object has no attribute 'close'
Traceback (most recent call last):
  File "/home/ubuntu/FRD_Project/routers/document.py", line 135, in get_documents_api
    documents = await get_uploaded_documents(ack_no) # <-- Call without executor
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/ubuntu/FRD_Project/db/matcher.py", line 134, in get_uploaded_documents
    conn.close() # Ensure connection is closed
    ^^^^^^^^^^
AttributeError: '_GeneratorContextManager' object has no attribute 'close'
INFO:     121.242.232.133:5629 - "GET /api/case/ACK12345678/documents HTTP/1.1" 500 Internal Server Error
INFO:     121.242.232.133:30242 - "GET /api/case/ACK12345678/decision HTTP/1.1" 200 OK
INFO:     121.242.232.133:65128 - "GET /api/case/ACK12345678/customer-details HTTP/1.1" 200 OK
INFO:     121.242.232.133:39255 - "GET /api/case/ACK12345678/decision HTTP/1.1" 200 OK
INFO:     121.242.232.133:30242 - "OPTIONS /api/case/ACK12345678/risk-profile HTTP/1.1" 200 OK
INFO:     121.242.232.133:65128 - "GET /api/case/ACK12345678/risk-profile HTTP/1.1" 200 OK
WARNING:  Invalid HTTP request received.
WARNING:  Invalid HTTP request received.
